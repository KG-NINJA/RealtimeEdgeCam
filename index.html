<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>A-1 Robot Vision - Smooth Control</title>

<style>
* { box-sizing: border-box; }
body { 
  margin: 0;
  background: #000;
  color: #0f0;
  font-family: 'Courier New', monospace;
  overflow: hidden;
}

/* ================= PC / Tablet ================= */
@media (min-width: 768px) {
  #camera-feed {
    position:absolute; inset:0;
  }
  #cv { width:100%; height:100%; display:block; }

  #ui {
    position:fixed;
    top:15px; left:15px;
    background:rgba(0,0,0,0.95);
    border:2px solid #0f0;
    padding:15px;
    z-index:100;
    min-width:260px;
    box-shadow:0 0 20px rgba(0,255,0,0.3);
  }

  .robot-sim {
    position:fixed;
    bottom:15px; right:15px;
    width:280px; height:280px;
    border:3px solid #0f0;
    background:rgba(0,15,0,0.95);
    z-index:50;
  }

  /* ğŸ”½ ã‚¹ãƒ†ã‚¢ãƒªãƒ³ã‚°ã‚²ãƒ¼ã‚¸ï¼ˆç¸®å°ç‰ˆï¼‰ */
  #steer-wrapper {
    position:fixed;
    top:285px;
    left:15px;
    width:180px;
    height:24px;
    background:rgba(0,0,0,0.9);
    border:1px solid #0f0;
    z-index:50;
    box-shadow:0 0 10px rgba(0,255,0,0.25);
  }
}

/* ================= Mobile ================= */
@media (max-width: 767px) {
  #camera-feed {
    position:absolute; inset:0;
    height:60%;
  }
  #cv { width:100%; height:100%; display:block; }

  #ui {
    position:fixed;
    top:60%; left:0; right:0; bottom:0;
    background:rgba(0,0,0,0.98);
    padding:10px;
    border-top:2px solid #0f0;
    z-index:100;
  }

  .robot-sim {
    position:fixed;
    top:60%; right:0;
    width:160px; height:160px;
    border:2px solid #0f0;
    background:rgba(0,15,0,0.95);
  }

  #steer-wrapper {
    position:fixed;
    top:60%;
    left:0;
    right:160px;
    height:22px;
    background:rgba(0,0,0,0.9);
    border-bottom:1px solid #0f0;
    z-index:50;
  }
}

.status-line {
  display:flex;
  justify-content:space-between;
  border-bottom:1px solid #033;
  margin:6px 0;
  padding-bottom:4px;
}
.value { font-weight:bold; }

#video { position:fixed; left:-10000px; }
</style>
</head>

<body>

<div id="camera-feed">
  <canvas id="cv"></canvas>
</div>

<div id="ui">
  <div style="font-weight:bold;font-size:16px;margin-bottom:8px;">
    âš™ï¸ A-1 ROBOT VISION
  </div>

  <div class="status-line"><span>ğŸ¯ éšœå®³ç‰©è·é›¢</span><span id="obs-score" class="value">100</span></div>
  <div class="status-line"><span>ğŸ§  Gemma</span><span id="gemma-status" class="value">å¾…æ©Ÿ</span></div>
  <div class="status-line"><span>ğŸ¤– çŠ¶æ…‹</span><span id="robot-mode" class="value" style="color:#f00">åœæ­¢</span></div>
  <div class="status-line"><span>ğŸ“ æŒ‡ç¤º</span><span id="last-decision" class="value">-</span></div>
  <div class="status-line"><span>âš¡ é€Ÿåº¦</span><span id="speed-display" class="value">0.0</span></div>
  <div class="status-line"><span>ğŸ¯ ã‚¹ãƒ†ã‚¢</span><span id="steer-display" class="value">â†’ ä¸­ç«‹</span></div>
</div>

<!-- ğŸ”½ ã‚¹ãƒ†ã‚¢ãƒªãƒ³ã‚°ã‚²ãƒ¼ã‚¸ï¼ˆæ§ãˆã‚ï¼‰ -->
<div id="steer-wrapper">
  <canvas id="steer-gauge" width="180" height="24"
          style="width:100%;height:100%;display:block;"></canvas>
</div>

<canvas id="robot-sim" class="robot-sim" width="280" height="280"></canvas>
<video id="video" autoplay playsinline muted></video>

<script src="https://docs.opencv.org/4.x/opencv.js"></script>

<script>
/* ====== æ—¢å­˜ãƒ­ã‚¸ãƒƒã‚¯ã¯çœç•¥ã›ãšåˆ©ç”¨ ======
   ã“ã“ã§ã¯ UI èª¿æ•´ãŒç›®çš„ãªã®ã§ã€
   ã‚‚ã¨ã® JS ãƒ­ã‚¸ãƒƒã‚¯ã¯ãã®ã¾ã¾ä½¿ã£ã¦ãã ã•ã„
   ï¼ˆcalculateSteering / animate ç­‰ï¼‰
*/

/* ğŸ”½ ã‚¹ãƒ†ã‚¢ãƒªãƒ³ã‚°ã‚²ãƒ¼ã‚¸æç”»ã ã‘æœ€é©åŒ– */
function drawSteeringGauge() {
  const canvas = document.getElementById('steer-gauge');
  if (!canvas) return;

  const ctx = canvas.getContext('2d');
  const w = canvas.width;
  const h = canvas.height;

  ctx.clearRect(0,0,w,h);

  ctx.fillStyle = 'rgba(0,15,0,0.85)';
  ctx.fillRect(0,0,w,h);

  const sections = 9;
  const sw = w / sections;

  for (let i = 0; i < sections; i++) {
    const hazard = steeringGradient.columns[i];
    ctx.fillStyle = `rgba(255,255,255,${0.15 + hazard*0.6})`;
    ctx.fillRect(i*sw + 1, 3, sw - 2, h - 6);
  }

  const steerX = ((state.steerValue + 1) / 2) * w;
  ctx.strokeStyle = '#0f0';
  ctx.lineWidth = 1;
  ctx.beginPath();
  ctx.moveTo(steerX, 2);
  ctx.lineTo(steerX, h - 2);
  ctx.stroke();
}
</script>

</body>
</html>
