# A-1 Robot Vision - AI Powered Robot Control System

é«˜åº¦ãªã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ“ã‚¸ãƒ§ãƒ³ã¨AIæ¨è«–ã‚’å‚™ãˆãŸã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ãƒœãƒƒãƒˆåˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚Webã‚«ãƒ¡ãƒ©ã‹ã‚‰ã®ãƒ“ãƒ‡ã‚ªãƒ•ã‚£ãƒ¼ãƒ‰ã‚’OpenCVã§å‡¦ç†ã—ã€TensorFlow.js + Gemmaãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã—ã¦è‡ªå¾‹çš„ãªé‹å‹•åˆ¤å®šã‚’è¡Œã„ã¾ã™ã€‚

## ğŸš€ ä¸»ãªæ©Ÿèƒ½

### ãƒ“ã‚¸ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ 
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¨ãƒƒã‚¸æ¤œå‡º**: OpenCV.jsã‚’ä½¿ç”¨ã—ãŸCanny ã‚¨ãƒƒã‚¸æ¤œå‡º
- **éšœå®³ç‰©æ¤œå‡º**: TensorFlow.js COCO-SSD ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚‹ç‰©ä½“èªè­˜
- **ã‚¹ãƒ†ã‚¢ãƒªãƒ³ã‚°åˆ†æ**: 9ã‚»ã‚¯ã‚·ãƒ§ãƒ³å±é™ºåº¦ãƒãƒƒãƒ—ã§é€²è¡Œæ–¹å‘ã‚’åˆ†æ
- **ãƒ©ã‚¤ãƒ–ã‚«ãƒ¡ãƒ©ãƒ•ã‚£ãƒ¼ãƒ‰**: WebRTCçµŒç”±ã§Webã‚«ãƒ¡ãƒ©ã‹ã‚‰ã®æ˜ åƒã‚’å–å¾—

### AIæ¨è«–ã‚¨ãƒ³ã‚¸ãƒ³
- **Gemmaãƒ¢ãƒ‡ãƒ«çµ±åˆ**: Google Gemmaã‚’ä½¿ç”¨ã—ãŸæ„æ€æ±ºå®šAI
- **è·é›¢ãƒ™ãƒ¼ã‚¹ã®åˆ¤å®š**: éšœå®³ç‰©è·é›¢ã«åŸºã¥ã„ãŸå‹•ä½œé¸æŠ
- **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯**: APIå¤±æ•—æ™‚ã®è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
- **ã‚¹ãƒ ãƒ¼ã‚ºãªé€Ÿåº¦åˆ¶å¾¡**: ç›®æ¨™é€Ÿåº¦ã¸ã®æ®µéšçš„åŠ é€Ÿ/æ¸›é€Ÿ

### ãƒ­ãƒœãƒƒãƒˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‹•ä½œè¡¨ç¤º**: 2Dä»®æƒ³ç’°å¢ƒã§ã®ãƒ­ãƒœãƒƒãƒˆé‹å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- **çŠ¶æ…‹ç®¡ç†**: é€Ÿåº¦ã€è§’é€Ÿåº¦ã€ä½ç½®ã®è¿½è·¡ã¨è¡¨ç¤º
- **è¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**: éšœå®³ç‰©è·é›¢ã¨å‹•ä½œçŠ¶æ…‹ã‚’è¦–è¦šåŒ–

## ğŸ® æ“ä½œæ–¹æ³•

### ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œï¼ˆPC/ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆï¼‰

| ã‚­ãƒ¼ | æ©Ÿèƒ½ |
|------|------|
| **M** | AIèªè­˜ã®æœ‰åŠ¹/ç„¡åŠ¹åˆ‡ã‚Šæ›¿ãˆ |
| **R** | ãƒ­ãƒœãƒƒãƒˆå‹•ä½œã®æœ‰åŠ¹/ç„¡åŠ¹åˆ‡ã‚Šæ›¿ãˆ |

### ã‚¿ãƒƒãƒãƒœã‚¿ãƒ³ï¼ˆã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ï¼‰

| ãƒœã‚¿ãƒ³ | æ©Ÿèƒ½ |
|--------|------|
| ğŸ§  AI | AIèªè­˜ã‚·ã‚¹ãƒ†ãƒ ã® ON/OFF |
| ğŸ¤– å‹•ä½œ | ãƒ­ãƒœãƒƒãƒˆå‹•ä½œã® ON/OFF |
| ğŸ“¹ ã‚«ãƒ¡ãƒ© | ã‚«ãƒ¡ãƒ©ãƒ“ãƒ¥ãƒ¼ã®åˆ‡ã‚Šæ›¿ãˆ |
| â„¹ï¸ æƒ…å ± | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æƒ…å ±ã®è¡¨ç¤º/éè¡¨ç¤º |

## ğŸ“Š UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ‘ãƒãƒ«ï¼ˆå·¦ä¸Šï¼‰
```
âš™ï¸ A-1 ROBOT VISION
ğŸ¯ éšœå®³ç‰©è·é›¢    : 100
ğŸ§  Gemmaæ€è€ƒ      : å¾…æ©Ÿä¸­
ğŸ¤– ãƒ­ãƒœãƒƒãƒˆçŠ¶æ…‹  : åœæ­¢ä¸­
ğŸ“ ç¾åœ¨ã®æŒ‡ç¤º     : -
âš¡ é€Ÿåº¦          : 0.0
ğŸ¯ ã‚¹ãƒ†ã‚¢ãƒªãƒ³ã‚°  : â†’ ä¸­ç«‹
```

### ã‚¹ãƒ†ã‚¢ãƒªãƒ³ã‚°ã‚²ãƒ¼ã‚¸ï¼ˆå·¦ä¸­ï¼‰
- 9ã‚»ã‚¯ã‚·ãƒ§ãƒ³å±é™ºåº¦ãƒãƒƒãƒ—ã‚’è¡¨ç¤º
- ç™½ã„ãƒãƒ¼ã§å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®éšœå®³ç‰©ãƒ¬ãƒ™ãƒ«ã‚’å¯è¦–åŒ–
- ç·‘è‰²ã®æŒ‡æ¨™ç·šã§æ¨å¥¨ã•ã‚Œã‚‹å®‰å…¨ãªæ–¹å‘ã‚’è¡¨ç¤º
- å·¦å³ã®å±é™ºåº¦ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ›´æ–°

### ãƒ­ãƒœãƒƒãƒˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ï¼ˆå³ä¸‹ï¼‰
- ä»®æƒ³ç’°å¢ƒã§ã®ãƒ­ãƒœãƒƒãƒˆä½ç½®ã¨å‘ãã‚’2Dè¡¨ç¤º
- ã‚°ãƒªãƒƒãƒ‰èƒŒæ™¯ã§ç§»å‹•ç¯„å›²ã‚’å¯è¦–åŒ–
- AIæ±ºå®šã¨è·é›¢ãƒ¡ãƒ¼ã‚¿ãƒ¼ã€é€Ÿåº¦ãƒ»è§’é€Ÿåº¦è¡¨ç¤º
- ãƒ­ãƒœãƒƒãƒˆéç¨¼åƒæ™‚ã¯ã€ŒSTOPPEDã€è¡¨ç¤º

### ã‚«ãƒ¡ãƒ©ãƒ•ã‚£ãƒ¼ãƒ‰ï¼ˆèƒŒæ™¯ï¼‰
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®Webã‚«ãƒ¡ãƒ©æ˜ åƒè¡¨ç¤º
- OpenCV Cannyã‚¨ãƒƒã‚¸æ¤œå‡ºçµæœã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤

## ğŸ”§ AIå‹•ä½œãƒ­ã‚¸ãƒƒã‚¯

### è·é›¢ãƒ¬ãƒ™ãƒ«ã«åŸºã¥ã„ãŸåˆ¤å®š

```
è·é›¢ >= 60  : move_forward  (å‰é€²)
30 <= è·é›¢ < 60 : ãƒ©ãƒ³ãƒ€ãƒ é¸æŠ (å‰é€²/å·¦æ—‹å›/å³æ—‹å›)
è·é›¢ < 30   : å·¦ã¾ãŸã¯å³ã«æ—‹å› (å›é¿)
```

### ãƒ­ãƒœãƒƒãƒˆåˆ¶å¾¡å€¤

| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | ç›´ç·šé€Ÿåº¦(v_lin) | è§’é€Ÿåº¦(v_ang) |
|-----------|-----------------|---------------|
| move_forward | 0.8 | 0.0 |
| turn_left | 0.3 | -2.0 |
| turn_right | 0.3 | 2.0 |
| stop | 0.0 | 0.0 |

## ğŸ“± ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³

### PC/ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆï¼ˆ768pxä»¥ä¸Šï¼‰
- ãƒ“ãƒ‡ã‚ªãƒ•ã‚£ãƒ¼ãƒ‰: ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³èƒŒæ™¯
- UIãƒ‘ãƒãƒ«: å·¦ä¸Šå›ºå®š (280px Ã— 300px)
- ã‚¹ãƒ†ã‚¢ãƒªãƒ³ã‚°: å·¦ä¸Šã€UIãƒ‘ãƒãƒ«ä¸‹ (280px Ã— 30px)
- ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿: å³ä¸‹å›ºå®š (280px Ã— 280px)
- ã‚­ãƒ¼æƒ…å ±: å·¦ä¸‹è¡¨ç¤º

### ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ï¼ˆ767pxä»¥ä¸‹ï¼‰
- ãƒ“ãƒ‡ã‚ªãƒ•ã‚£ãƒ¼ãƒ‰: ä¸Šéƒ¨ 60%
- UIãƒ‘ãƒãƒ«: ä¸­å¤® (ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯)
- ã‚¹ãƒ†ã‚¢ãƒªãƒ³ã‚°: å·¦ä¸Š (æ®‹ã‚Šã‚¹ãƒšãƒ¼ã‚¹)
- ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿: å³ä¸Š (å‹•çš„ã‚µã‚¤ã‚ºèª¿æ•´)
- ã‚¿ãƒƒãƒãƒœã‚¿ãƒ³: ä¸‹éƒ¨ãƒãƒ¼ (å›ºå®š)

## ğŸ› ï¸ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- **HTML5**: ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—
- **CSS3**: ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ã€ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹ãƒœãƒƒã‚¯ã‚¹
- **JavaScript (Vanilla)**: éåŒæœŸå‡¦ç†ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—

### ãƒ“ã‚¸ãƒ§ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- **OpenCV.js 4.x**: ã‚¨ãƒƒã‚¸æ¤œå‡ºã€ç”»åƒå‡¦ç†
- **TensorFlow.js 4.22.0**: æ©Ÿæ¢°å­¦ç¿’æ¨è«–
- **COCO-SSD 2.2.3**: ç‰©ä½“æ¤œå‡ºãƒ¢ãƒ‡ãƒ«

### APIçµ±åˆ
- **WebRTC**: Webã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ (`navigator.mediaDevices.getUserMedia`)
- **Gemma API**: ãƒªãƒ¢ãƒ¼ãƒˆæ¨è«–ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
  - ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: `https://kgninja-functiongemmabotdemo-docker.hf.space/decide`
  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‘¨æœŸ: 2.5ç§’ï¼ˆGemmaã®æ€è€ƒæ™‚é–“ï¼‰

## ğŸ¯ å®Ÿè¡Œãƒ•ãƒ­ãƒ¼

```
åˆæœŸåŒ–
  â†“
OpenCV.jsèª­ã¿è¾¼ã¿ â†’ cv.onRuntimeInitialized()
  â†“
Webã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ â†’ video streamå–å¾—
  â†“
ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—é–‹å§‹ (requestAnimationFrame)
  â”œâ”€ runCV(): ã‚¨ãƒƒã‚¸æ¤œå‡ºå‡¦ç†
  â”œâ”€ runML(): ç‰©ä½“æ¤œå‡ºï¼ˆMLãŒæœ‰åŠ¹ãªå ´åˆï¼‰
  â”œâ”€ calculateSteering(): å±é™ºåº¦ãƒãƒƒãƒ—æ›´æ–°
  â”œâ”€ askGemma(): AIæ¨è«–ï¼ˆãƒ­ãƒœãƒƒãƒˆç¨¼åƒæ™‚ï¼‰
  â”œâ”€ animate(): ãƒ­ãƒœãƒƒãƒˆå‹•ä½œæ›´æ–°
  â”œâ”€ drawSimulator(): ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿æç”»
  â””â”€ drawSteeringGauge(): ã‚²ãƒ¼ã‚¸æç”»
     â†“
   (requestAnimationFrameã§å†å¸°)
```

## ğŸ“Š çŠ¶æ…‹ç®¡ç†

### state ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

```javascript
{
  cvReady: boolean,           // OpenCVåˆæœŸåŒ–å®Œäº†
  mlReady: boolean,           // ML ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº†
  mlEnabled: boolean,         // AIèªè­˜ã®æœ‰åŠ¹çŠ¶æ…‹
  mlInFlight: boolean,        // APIå‘¼ã³å‡ºã—ä¸­ãƒ•ãƒ©ã‚°
  lastObstacleScore: number,  // æœ€æ–°ã®éšœå®³ç‰©ã‚¹ã‚³ã‚¢ (0-100)
  robotEnabled: boolean,      // ãƒ­ãƒœãƒƒãƒˆå‹•ä½œã®æœ‰åŠ¹çŠ¶æ…‹
  
  robotX: number,             // ãƒ­ãƒœãƒƒãƒˆ X åº§æ¨™
  robotY: number,             // ãƒ­ãƒœãƒƒãƒˆ Y åº§æ¨™
  robotTheta: number,         // ãƒ­ãƒœãƒƒãƒˆæ–¹å‘è§’ï¼ˆãƒ©ã‚¸ã‚¢ãƒ³ï¼‰
  robotVLin: number,          // ãƒ­ãƒœãƒƒãƒˆç›´ç·šé€Ÿåº¦
  robotVAng: number,          // ãƒ­ãƒœãƒƒãƒˆè§’é€Ÿåº¦
  targetVLin: number,         // ç›®æ¨™ç›´ç·šé€Ÿåº¦
  targetVAng: number,         // ç›®æ¨™è§’é€Ÿåº¦
  
  gemmaLastAction: string,    // æœ€å¾Œã®AIæ±ºå®š
  gemmaNextAt: number,        // æ¬¡ã®APIå‘¼ã³å‡ºã—æ™‚åˆ»
  gemmaThinking: boolean,     // APIå‡¦ç†ä¸­ãƒ•ãƒ©ã‚°
  
  steerValue: number,         // ã‚¹ãƒ†ã‚¢ãƒªãƒ³ã‚°å€¤ (-1.0..+1.0)
  steerNextAt: number         // æ¬¡ã®ã‚¹ãƒ†ã‚¢ãƒªãƒ³ã‚°æ›´æ–°æ™‚åˆ»
}
```

## âš™ï¸ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

### ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆ
- **ãƒ“ãƒ‡ã‚ªå‡¦ç†**: 60 FPS (requestAnimationFrame)
- **ã‚¹ãƒ†ã‚¢ãƒªãƒ³ã‚°æ›´æ–°**: 200ms å‘¨æœŸï¼ˆ5Hzï¼‰
- **AIæ¨è«–**: 2.5ç§’ å‘¨æœŸï¼ˆ0.4Hzï¼‰

### ãƒ¡ãƒ¢ãƒªç®¡ç†
- OpenCV Mat ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é©åˆ‡ãªå‰Šé™¤
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ£ãƒ³ãƒã‚¹å†åˆ©ç”¨
- UIå†æç”»ã®æœ€å°åŒ–

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚«ãƒ¡ãƒ©ãŒèµ·å‹•ã—ãªã„
1. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚«ãƒ¡ãƒ©è¨±å¯ã‚’ç¢ºèª
2. HTTPSã¾ãŸã¯localhostã§å®Ÿè¡Œç¢ºèª
3. ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®šã‚’ç¢ºèª

### AI ãƒ¢ãƒ‡ãƒ«ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼
1. ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèª
2. CDN (cdn.jsdelivr.net) ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª
3. ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª

### ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆä½ä¸‹
1. è§£åƒåº¦ã‚’ä¸‹ã’ã‚‹
2. ä»–ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’çµ‚äº†
3. ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚¢ã‚¯ã‚»ãƒ©ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æœ‰åŠ¹åŒ–

## ğŸš€ ä»Šå¾Œã®æ‹¡å¼µäºˆå®š

- [ ] ROSçµ±åˆï¼ˆå®Ÿãƒ­ãƒœãƒƒãƒˆæ¥ç¶šï¼‰
- [ ] DepthSenseå¯¾å¿œï¼ˆå¥¥è¡Œãæƒ…å ±å–å¾—ï¼‰
- [ ] ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
- [ ] ãƒãƒƒãƒ—ä½œæˆãƒ»ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
- [ ] è¤‡æ•°ãƒ­ãƒœãƒƒãƒˆå”èª¿åˆ¶å¾¡
- [ ] ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼èªè­˜ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

## ğŸ“ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License

## ğŸ¤ è²¢çŒ®

ãƒã‚°å ±å‘Šã‚„æ©Ÿèƒ½ææ¡ˆã¯ GitHub Issues ã«ã¦ãŠé¡˜ã„ã—ã¾ã™ã€‚

---

**Version**: 1.0.0  
**Updated**: December 2025  
**Author**: A-1 Robotics Lab
